XA.connector.mapsConnector=function(e,t){"use strict";function o(o){google.maps.event.addListenerOnce(o,"domready",(function(){e(t).trigger("infowindowOpen",o)}))}var n,a,i,r,s={},c=[],l=[],d=[],p=[],g=!1;return a=function(e){switch(e.mode){case"Roadmap":default:return google.maps.MapTypeId.ROADMAP;case"Satellite":return google.maps.MapTypeId.SATELLITE;case"Hybrid":return google.maps.MapTypeId.HYBRID}},i=function(e,t){var o;return o=null===t.icon?new google.maps.Marker({position:new google.maps.LatLng(t.latitude,t.longitude),map:c[e],title:t.title}):new google.maps.Marker({position:new google.maps.LatLng(t.latitude,t.longitude),map:c[e],title:t.title,icon:t.icon}),""===t.latitude&&""===t.longitude&&o.setVisible(!1),o},r=function(e,t,o){t.id=o.id,l[e]||(l[e]=[]),l[e].push({marker:t,type:o.type})},s.loadScript=function(e,o){if(p.push(o),!g){g=!0;var n=t.createElement("script"),a="https://maps.googleapis.com/maps/api/js?v=3.exp";n.type="text/javascript",a+=void 0!==e&&""!==e?"&key="+e+"&v=3.exp&signed_in=false":"&signed_in=false",a+="&libraries=places&callback=XA.connector.mapsConnector.scriptsLoaded",n.src=a,n.onload=function(){console.log("Google loader has been loaded, waiting for maps api")},t.body.appendChild(n)}},s.scriptsLoaded=function(){var e,t=p.length;for(e=0;e<t;e++)p[e].call();g=!1},s.showMap=function(e,o,i){var r,s,d="1"!==o.disableMapZoomOnScroll,p="1"!==o.disableMapScrolling;i instanceof Array?(r={zoom:o.zoom,scrollwheel:d,draggable:p,center:new google.maps.LatLng(i[0],i[1]),mapTypeId:a(o)},n=new google.maps.Map(t.getElementById(o.canvasId),r)):(r={scrollwheel:d,draggable:p,mapTypeId:a(o)},(n=new google.maps.Map(t.getElementById(o.canvasId),r)).fitBounds(i),o.poiCount<2&&(s=google.maps.event.addListener(n,"idle",(function(){Object.keys(l).length>0&&l[e].length<2&&(n.setZoom(o.zoom),google.maps.event.removeListener(s))})))),google.maps.event.addListener(n,"zoom_changed",(function(e,t,o,a){n.getZoom()<1&&n.setZoom(1)})),c[e]=n},s.renderPoi=function(e,t){var n=i(e,t),a=e+"#"+t.id;r(e,n,t),""!==t.html&&null!==t.html&&(d[a]=new google.maps.InfoWindow({content:t.html})),void 0!==d[a]&&function(t,n){google.maps.event.addListener(n,"click",(function(){for(var a in d)d.hasOwnProperty(a)&&d[a].close();d[t].open(c[e],n),o(d[t])}))}(a,n)},s.renderDynamicPoi=function(e,t,n){var a=i(e,t);r(e,a,t),google.maps.event.addListener(a,"click",(function(){if("function"==typeof n){var i=t.id,r=t.poiTypeId,s=t.poiVariantId;if(null==s)return;n(i,r,s,(function(t){d[e]&&d[e].close(),d[e]=new google.maps.InfoWindow({content:t.Html}),d[e].open(c[e],a),o(d[e])}))}}))},s.clearMarkers=function(e){var t;if(l.hasOwnProperty(e)){t=l[e];for(var o=0;o<t.length;o++)"Dynamic"===t[o].type&&t[o].marker.setMap(null);l[e]=t.filter((function(e){return"Static"===e.type||"MyLocation"===e.type}))}},s.updateMapPosition=function(e){var t,o,n=c[e],a=[],i=new google.maps.LatLngBounds;for(l.hasOwnProperty(e)&&(a=l[e]),o=0;o<a.length;o++)t=a[o].marker,i.extend(new google.maps.LatLng(t.position.lat(),t.position.lng()));n.fitBounds(i)},s.centerMap=function(e,t,o,n){var a,i=c[e],r=[];if(o&&i.setCenter(new google.maps.LatLng(t.coordinates[0],t.coordinates[1])),n){l.hasOwnProperty(e)&&(r=l[e]);for(var s=0;s<r.length;s++)r[s].marker.setAnimation(null),r[s].marker.id===t.id&&(a=r[s].marker,r[s].marker.setMap(null));void 0!==a&&(a.setMap(i),a.setAnimation(google.maps.Animation.BOUNCE),setTimeout((function(){a.setMap(i)}),2e3))}},s.getCentralPoint=function(e){var t,o,n=e.length,a=new google.maps.LatLngBounds;for(t=0;t<n;t++)""!==(o=e[t]).latitude&&""!==o.longitude&&a.extend(new google.maps.LatLng(o.latitude,o.longitude));return a},s.locationAutocomplete=function(e,t,o){var n=new google.maps.places.AutocompleteService,a=e.maxResults<=0?1:e.maxResults;n.getQueryPredictions({input:e.text},(function(e){var n,i=[];if(null!=e&&e.length){n=e.length>=a?a:e.length;for(var r=0;r<n;r++)i.push(_.extend(e[r],{text:e[r].description}));t(i)}else o()}))},s.addressLookup=function(e,o,a){var i;e.hasOwnProperty("place_id")?new google.maps.places.PlacesService(void 0!==n?n:new google.maps.Map(t.createElement("div"))).getDetails({placeId:e.place_id},(function(e,t){t!=google.maps.places.PlacesServiceStatus.OK||void 0===e||void 0===e.geometry.location?a():o([e.geometry.location.lat(),e.geometry.location.lng()])})):(i={address:e.text},(new google.maps.Geocoder).geocode(i,(function(e,t){t!=google.maps.GeocoderStatus.OK||void 0===e[0]||void 0===e[0].geometry.location?a():o([e[0].geometry.location.lat(),e[0].geometry.location.lng()])})))},s.updateMyPoiLocation=function(e,t,o){var n,a=c[e];l.hasOwnProperty(e)&&(n=l[e].filter((function(e){return"MyLocation"===e.type}))).length>0&&(n[0].marker.setPosition(new google.maps.LatLng(t[0],t[1])),n[0].marker.setVisible(!0),this.updateMapPosition(e),void 0!==o&&a.setZoom(o))},s.getMaps=function(){return c},s.getLastMap=function(){return n},s}(jQuery,document),XA.component.customLocationRatingAndReview=function(e,t){"use strict";function o(t,o){return function(n,a){if(a===google.maps.places.PlacesServiceStatus.OK){var i={placeId:n[0].place_id,fields:["rating","user_ratings_total","reviews"]},r=XA.connector.mapsConnector.getMaps()[e(".map-canvas").attr("id")];new google.maps.places.PlacesService(r).getDetails(i,function(t,o){return function(n,a){a==google.maps.places.PlacesServiceStatus.OK&&o.length>0&&t.length>0&&null!=n.rating&&null!=n.user_ratings_total&&(t.toggleClass("ratings-and-reviews"),t.removeClass("d-none"),t.html(t.html().replace("#average_rating#",`${n.rating.toFixed(1)} <i data-star="${n.rating.toFixed(1)}"></i>`).replace("#review_count#",n.user_ratings_total)),t.click((function(){var o,a=e(`${t.attr("id")}-modal`),i=e("#exampleModal");if(0!=i.length){if(0==a.length){var r=e(`#${t.attr("id")}-main .title`).text(),s=t.html();(o=i.clone()).attr("id",`${t.attr("id")}-modal`),o.removeClass("d-none"),o.find(".modal-title").text(r),o.find(".modal-rating-and-review").html(s);var c=o.find(".google-review-comment");e.each(n.reviews,(function(e,t){var n=c.clone();n.find(".profile_photo_url").attr("src",t.profile_photo_url),n.find(".author_name").text(t.author_name),n.find(".author_name").attr("href",t.author_url),n.find(".rating").html(`${t.rating.toFixed(1)} <i data-star="${t.rating.toFixed(1)}"></i>`),n.find(".relative_time_description").text(t.relative_time_description),n.find(".time").text(function(e){const t=new Date(1e3*e);return t.toLocaleString()}(t.time)),n.find(".text").text(t.text),n.appendTo(o.find(".google-review-comment").parent()),n.removeClass("d-none")})),o.find(".more_reviews").attr("href",`https://www.google.com/maps?q=${encodeURIComponent(r)}`),o.find(".more_reviews").detach().appendTo(o.find(".google-review-comment").parent()),o.appendTo(e("exampleModal").parent())}else o=a;new bootstrap.Modal(o,{keyboard:!1}).toggle()}})),o.remove())}}(t,o))}}}var n={},a=!1;return n.init=function(){e("body").hasClass("on-page-editor")||!a&&t.querySelector(".component.map")&&(a=!0,n.listenInfowindowOpenEvent())},n.setRatingAndReviewBySearchText=function(t,n,a){var i=e(`#${t}`),r=e(`#${n}`);if(i.html().indexOf("#average_rating#")>-1||i.html().indexOf("#review_count#")>-1){var s={query:a,fields:["place_id"]},c=XA.connector.mapsConnector.getMaps()[e(".map-canvas").attr("id")];new google.maps.places.PlacesService(c).findPlaceFromQuery(s,o(i,r))}},n.listenInfowindowOpenEvent=function(){e(t).on("infowindowOpen",(function(t,o){var a=e(".rating-and-review-main");a.length>0&&a.each((function(){var t=e(this).attr("id"),o=t.replace("-rating-and-review-main",""),a=`${o}-rating-and-review`,i=`${o}-no-rating-and-review`,r=e(`#${t} .title`).text();n.setRatingAndReviewBySearchText(a,i,r)}))}))},n}(jQuery,document),XA.register("CustomLocationRatingAndReview",XA.component.customLocationRatingAndReview),XA.component.customlocationfinder=function(e,t){"use strict";var o,n,a,i,r={},s=[],c=!1,l=XA.connector.mapsConnector;return i=function(){var e;for(e=0;e<s.length;e++)new a({el:s[e],model:new n})},n=Backbone.Model.extend({defaults:{dataProperties:{},sig:[]},initAutocompleteEngine:function(){var e,t=this;t.get("dataProperties").p>0&&((e=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:t.get("dataProperties").p,remote:{url:"-",replace:function(){return Date.now().toString()},transport:function(e,o,n){var a=t.get("queryParams");a.text?l.locationAutocomplete(a,(function(e){var t=e.map((function(e){return e.hasOwnProperty("text")?e.text:e}));o(t)}),(function(){n("Could not autocomplete")})):o([])}}})).initialize(),this.set({searchEngine:e}))}}),a=XA.component.search.baseView.extend({initialize:function(){var e=this,t=this.$el.data(),o=this.$el.find(".location-search-box-input"),n=t.properties.searchResultsSignature.split(",");null===t.properties.searchResultsSignature&&(t.properties.searchResultsSignature=""),this.model.set({dataProperties:t.properties}),this.model.set({sig:n}),this.model.set({queryParams:{maxResults:t.p,text:""}}),this.model.initAutocompleteEngine();var a=this.model.get("searchEngine");a&&o.typeahead({hint:!0,minLength:2},{source:a.ttAdapter(),templates:{suggestion:function(e){return'<div class="suggestion-item">'+e+"</div>"}}}).on("typeahead:selected",(function(t,n){e.translateUserLocation(n),o.typeahead("val",n)})),this.addressLookup(!0),XA.component.search.vent.on("hashChanged",(function(e){var t=e[n.length>0&&""!==n[0]?n[0]+"_a":"a"];null!=t&&""!==t&&o.val(t)}))},events:{"click .location-search-box-button":"addressLookup","keypress .location-search-box-input":"searchTextChanges","keyup .location-search-box-input":"autocomplete"},addressLookup:function(e){var t,o=this.model.get("dataProperties"),n={text:this.getAddress(e),maxResults:1};switch(""===n.text&&(t=this.createHashObject("","",""),this.updateHash(t,o)),o.mode){case"Location":this.detectLocation();break;case"UserProvided":this.translateUserLocation(n);break;case"Mixed":void 0===n.text||""===n.text?this.detectLocation():this.translateUserLocation(n)}},getAddress:function(e){var t,n=this.$el.find(".location-search-box-input.tt-input"),a=0!==n.length?n.val():this.$el.find(".location-search-box-input").val(),i=o.parseHashParameters(window.location.hash),r=this.model.get("sig");return!0===e||""!==a&&void 0!==a?(""!==a&&void 0!==a||(""!==(t=i[r.length>0&&""!==r[0]?r[0]+"_a":"a"])&&(a=t),void 0===a&&(a="")),a):""},autocomplete:function(e){var t,o,n=this.model.get("dataProperties");e.stopPropagation(),13!==e.keyCode&&(o={text:0!==(t=this.$el.find(".location-search-box-input.tt-input")).length?t.val():this.$el.find(".location-search-box-input").val(),maxResults:n.p},this.model.set({queryParams:o}))},searchTextChanges:function(e){return e.stopPropagation(),13!==e.keyCode||(this.addressLookup(!1),!1)},translateUserLocation:function(e){var t=this,o=this.model.get("dataProperties"),n=void 0!==e.text?e.text:e,a=this.$el.find(".location-search-box-input.tt-input"),i={};""!==n&&(l.addressLookup({text:n},(function(e){i=t.createHashObject(e[0]+"|"+e[1],o.f+",Ascending"),t.updateHash(i,o)}),(function(){console.error("Error while getting '"+n+"' location")})),a.blur(),""===a.val()&&a.val(n))},detectLocation:function(){var e=this.model.get("dataProperties"),t=this.$el.find(".location-search-box-input"),n=(this.model.get("sig"),o.parseHashParameters(window.location.hash),{}),a=this;XA.component.locationService.detectLocation((function(o){n=a.createHashObject(o[0]+"|"+o[1],e.f+",Ascending"),a.updateHash.call(a,n,e),t.length>0&&t.attr("placeholder",e.myLocationText)}),(function(e){console.log(e)}))},updateHash:function(e,t){var n,a,i,r=this.model.get("sig"),s=void 0!==XA.component.search?XA.component.search.results.searchResultModels:[],c=this.$el.find(".location-search-box-input.tt-input"),l=0!==c.length?c.val():this.$el.find(".location-search-box-input").val();for(a=0;a<s.length;a++)for(i=0;i<r.length;i++)n=r[i],s[a].get("dataProperties").sig===n&&s[a].set("loadMoreOffset",0);if(null!==l&&""!==l)for(a=0;a<r.length;a++)e[""!==(n=r[a])?n+"_a":"a"]=l;for(o.updateHash(e,t.targetUrl),a=0;a<r.length;a++)XA.component.search.vent.trigger("my-location-coordinates-changed",{sig:r[a],coordinates:e[""!==r[a]?r[a]+"_cg":"cg"].split("|")})},createHashObject:function(e,t,o){var n,a,i=this.model.get("sig"),r={};for(a=0;a<i.length;a++)r[""!==(n=i[a])?n+"_cg":"cg"]=e,r[""!==n?n+"_o":"o"]=t,void 0!==o&&(r[""!==n?n+"_a":"a"]=o);return r}}),r.init=function(){if(!e("body").hasClass("on-page-editor")){o=XA.component.search.query,XA.component.search.url;var t=e(".custom-location-filter:not(.initialized)");_.each(t,(function(t){var o=e(t),n=o.data("properties");s.push(o),c||"Location"===n.mode?i():l.loadScript(n.key,XA.component.customlocationfinder.scriptsLoaded),o.addClass("initialized")}))}},r.scriptsLoaded=function(){c||(console.log("Maps api loaded"),c=!0,i())},r}(jQuery,document),XA.register("customlocationfinder",XA.component.customlocationfinder),XA.component.geolocationcookiemanger=function(e,t){"use strict";var o={},n=!1;return o.SetGeoLocationCookie=function(t){var o=!1,n=e("*[data-properties]");_.each(n,(function(n){var a=e(n).data("properties").searchResultsSignature;if(void 0!==a){var i=a.length>0&&""!==a?a+"_g":"g",r=t[i];null!=r&&""!==r&&XA.cookies.readCookie(i)!==r&&(XA.cookies.createCookie(i,r),o=!0)}})),o&&window.location.reload()},o.init=function(){if(!e("body").hasClass("on-page-editor")&&!n){n=!0;var t=XA.component.search.query.parseHashParameters(window.location.hash);this.api.SetGeoLocationCookie(t),XA.component.search.vent.on("hashChanged",this.api.SetGeoLocationCookie)}},o}(jQuery,document),XA.register("geolocationcookiemanger",XA.component.geolocationcookiemanger);